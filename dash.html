<!DOCTYPE html>
<HTML lang="en">
<HEAD>
    <title>Earthcal</title>
    <link rel="icon" href="assets/icons/favicon.ico" />
    <!--
    EARTHCYCLES CALENDAR PROJECT
    Code and Calendar by Russell Maier
    Copyright 2020-2025
    https://calendar.earthen.io
    https://github/russs95/earthcal
    https://earthcal.app

    Z-INDEX FOR COMPONENTS:

    EarthCycles: 0;
    main-menu-overlay: 56;
    #registration-footer: 50
    target-date-info: 40

    time-controller: 20;
    planet-info-box: 20;
    animal-info-box: 10
    user-timezone-lang: 20;
    add-event-button: 20;
    date-controls: 20;
    top right menu button-list: 20;
    bottom right icon-button-columns: 10;
    bottom right horiz kin-buttons: 15;
    bottom right horiz planet-buttons: 20;
    bottom-info: 9  needed?
    #form-modal-message: 15

    -->

    <!--  PRELOADING-->
    <!-- Dark images -->
    <link rel="preload" as="image" href="svgs/up-reg-arrow-dark.svg" />
    <link rel="preload" as="image" href="svgs/up-reg-arrow-dark-over.svg" />
    <link rel="preload" as="image" href="svgs/up-reg-arrow-dark-active.svg" />
    <link
            rel="preload"
            as="image"
            href="svgs/up-reg-arrow-dark-active-hover.svg"
    />
    <!-- Light images -->
    <link rel="preload" as="image" href="svgs/up-reg-arrow-light.svg" />
    <link rel="preload" as="image" href="svgs/up-reg-arrow-light-over.svg" />
    <link rel="preload" as="image" href="svgs/up-reg-arrow-light-active.svg" />
    <link
            rel="preload"
            as="image"
            href="svgs/up-reg-arrow-light-active-hover.svg"
    />

    <link rel="canonical" href="https://earthcal.app/" />
    <link rel="alternate" href="https://earthcal.app/" hreflang="en" />
    <link rel="alternate" href="https://earthcal.app/" hreflang="x-default" />

    <meta
            name="keywords"
            content="circular calendar, to-do, cycles, earthen, grey whale, black stork, calendar, circular, solar system, planet, planet positions, earth, mars, venus, mercury, jupiter, uranus, saturn"
    />
    <meta name="description" content="Sync your moments with Earth's cycles." />

    <meta name="author" content="Earthen.io" />

    <!-- Facebook Open Graph Tags for social sharing-->
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta property="og:url" content="https://earthcal.app/" />
    <meta property="og:type" content="app" />
    <meta
            property="og:title"
            content="EarthCal | The Earthen Cycles Calendar"
    />
    <meta
            property="og:description"
            content="Sync your moments with Earth's cycles."
    />
    <meta property="og:image" content="images/cal-banner.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="753" />
    <meta
            property="og:image:alt"
            content="An interactive series of circles representing the cycles of Earth, the solar system and the moon."
    />

    <meta property="og:locale" content="en_GB" />

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, target-density dpi=160, maximum-scale=5, user-scalable = yes"
    />

    <script src="js/earthcal-config.js"></script>
    <script src="js/earthcal-init.js?v=10.93"></script>

    <!--Default Light Styles to load first-->
    <link rel="preload" href="css/light.css?v=7.1" as="style" onload="this.rel='stylesheet'">

    <!--Stylesheets for light and dark mode.  They need to be called here-->
    <link rel="stylesheet" href="css/light.css?v=7.1" media="(prefers-color-scheme: no-preference), (prefers-color-scheme: light)">
    <link rel="stylesheet" href="css/dark.css?v=7.1" media="(prefers-color-scheme: dark)">
    <link rel="stylesheet" href="css/slider.css?v=1.2">

    <!-- Main Calendar Stylesheet-->
    <link rel="stylesheet" href="css/1-stylesheet.css?v=6.94">
    <link rel="stylesheet" href="css/login-styles.css?v=7.2">
    <link rel="stylesheet" href="css/mini-mode.css?v=1">

    <!-- Inline styles current being experimented with-->
    <style>
    </style>
    <script src="js/gsap.min.js"></script>
    <script src="js/MotionPathPlugin.min.js"></script>
    <script>
        function displayMoonPhaseOnHover(event) {
            const pathId = event.target.id;
            const [dayOfYear, day, month, year] = pathId.split('-').slice(0, 4);
            const date = new Date(year, month - 1, day);
            displayMoonPhaseInDiv(date);
            updateMoonPhase(date);
        }
    </script>
    <script src="js/1-lunar-scripts.js"></script>
    <script>


        //Initiate
        gsap.registerPlugin(MotionPathPlugin);

        /*ROLL CALL*/
        async function initializePage() {
            const solarCenterDiv = document.getElementById('solar-system-center');
            const dayLinesDiv = document.getElementById('days-of-year-lines');
            const allDaymarkers = document.getElementById('all-daymarkers');
            const whiteBack = document.getElementById('white-back-for-day');
            const rayLine = document.getElementById('ray_lines');
            // ANIMATED DISPLAY of the Calendar Interface
            setTimeout(() => {
                dayLinesDiv.style.opacity = '1';
                whiteBack.style.opacity = '1';
                rayLine.style.opacity = '1';
            }, 2000);
            setTimeout(() => {
                allDaymarkers.style.opacity = '1'; // Show allDaymarkers
            }, 4000);
            updateBackgroundColor();   //Updates colors for night and day themese
            updateHighlightColor(); //Updates colors for night and day themese

            // Check for shared event via URL parameters
            const params = new URLSearchParams(window.location.search);
            if (params.get('status') === 'firsttime') {  // 🌀 Welcome new Earthling!
                alert("Welcome!  Looks like this is your first time logging into Earthcal with your Buwana account.  See the user menu at the bottom left corner for your newfound calendar powers.");
            }

            if (params.get('action') === 'add-event') {  // 🌀 Add new shared event
                const sharedDate = params.get('date');
                let year, month, day;

                if (sharedDate) {
                    [year, month, day] = sharedDate.split('-').map(Number);
                    window.targetDate = new Date(year, month - 1, day);
                }

                const cycleData = {
                    frequency: params.get('f'),
                    title: decodeURIComponent(params.get('t') || ''),
                    datecycle_color: params.get('c'),
                    comments: decodeURIComponent(params.get('n') || ''),
                    id: params.get('id'),
                    from: decodeURIComponent(params.get('from') || 'An Earthcal user'),
                    year,
                    month,
                    day
                };

                prefillAddDateCycle(cycleData);
            } else {
                setCurrentDate(); // Fallback if no shared event
                if (userAnimations) animatePlanetsIfReady();
              }

              const currentYear = parseInt(currentYearText.textContent); //gets the year from the currentYearText div

            cyclesToggleSimplified();  // to show/hide animal cycles
            initializeToggleListener();  //to show or hide datecycles?
            updateDayIds(currentYear);  //Updates the day ids for the current year
            updateDayTitles(currentYear);  //Updates the day titles for the current year
            title2tooltip();   //Adds titles tooltips to the non-date paths
            title2datetip();   //Adds titles to the date paths
            triggerPlanets();  //Enables the planet animations to be triggered.
            listenForMonthBreakout();
            listenForCloseBreakout();
            attachBreakoutTouchListeners();
            // displayMoonPhaseInDiv(targetDate); //not needed this is for the moon info div!
            addMoonPhaseInteraction();
            // displayCurrentMoonPhase();
            updateMoonPhase(targetDate);
            // Initialize event listeners for the Sun SVG paths and reset the Moon phase to the current date
              addDayPathEventListeners();
              resetMoonPhase();
              setTimeout(function() {
                startDate = targetDate;
                if (params.get('action') === 'add-event') {
                    if (userAnimations) animatePlanetsIfReady();
                }
                setYearsMonthsOn();
                updateTargetMonth();
                if (localStorage.getItem('buwana_id')) {
                    // Clear out all local cached datecycles (keys starting with "calendar_")
                    Object.keys(localStorage).forEach(key => {
                        if (key.startsWith('calendar_')) {
                            localStorage.removeItem(key);
                        }
                    });
                    // Proceed with syncing and then highlighting.
                    syncDatecycles()
                        .then(() => {
                            highlightDateCycles(targetDate);
                        })
                        .catch(err => {
                            console.error("Sync error:", err);
                        });
                } else {
                    highlightDateCycles(targetDate);
                }
                calculateHijriMonthNames(currentYear);
                setLunarMonthForTarget(targetDate, currentYear);
            }, 1500);

            setTimeout(updateTargetDay, 2500);
            openPlanetInfoBox();

            //checkTourToken();
            // Check if the version  has already been seen
            // const tokenKey = 'newVersionInfoSeen';
            //     if (!localStorage.getItem(tokenKey)) {
            // setTimeout(showIntroModal, 5000);
            // };
            // //setTimeout(openCurrentMonthBreakout,4000);
            // setTimeout(triggerBreakoutDay,4000);  //allows the selected breakout to be highlighted
            await getUserData(); // This sets time_zone, targetDate, etc.
            displayDayInfo(targetDate, userLanguage, userTimeZone);
            if (userClock) openClock(userTimeZone);
        }

    </script>
</HEAD>

<BODY style="overflow: hidden !important;">

<!--INFO MODAL-->
<div id="form-modal-message" class="modal-hidden">
    <button type="button" onclick="closeTheModal()" aria-label="Click to close modal" class="x-button"></button>
    <div class="modal-content-box">
        <div id="modal-content" class="modal-message"></div>
    </div>
    <div id="ec-global-emoji-selector" class="ec-emoji-selector" aria-hidden="true">
        <div class="ec-emoji-selector-panel" role="dialog" aria-modal="true" aria-label="Emoji selector">
            <button type="button" class="ec-emoji-selector-close" aria-label="Close emoji selector">×</button>
            <div class="ec-emoji-picker" id="ec-global-emoji-grid" role="listbox" aria-label="Choose an emoji"></div>
        </div>
    </div>
</div>

<!-- DATE SEARCH -->
<div id="day-search" class="modal-hidden" >
    <button
            type="button"
            onclick="closeSearchModal()"
            aria-label="Click to close modal"
            class="x-button">
    </button>

    <div class="search-modal-content">
        <div class="top-search-icon" ></div>
        <h2 id="date-search-title" style="text-align: center;"></h2>

        <input
                type="number"
                id="day-field"
                placeholder=""
                class="blur-form-field"
                style="text-align: center;">

        <select
                id="month-field"
                class="blur-form-field"
                style="text-align: center;">
        </select>

        <div
                class="year-buttons blur-form-field"
                style="display: flex; flex-flow: row; justify-content: center;">
            <div
                    id="prev-year-search"
                    class="next-button"
                    aria-label=""
                    title=""
                    style="margin: auto auto auto 10px;">
            </div>
            <div class="searched-year">2025</div>
            <div
                    id="next-year-search"
                    class="next-button"
                    aria-label=""
                    title=""
                    style="margin: auto 10px auto auto;">
            </div>
        </div>

        <button
                id="search-button"
                class="stellar-submit">
        </button>
    </div>
</div>

<!-- LOGIN FOOTER CURTAIN frfrddd-->
<div id="registration-container">
    <button id="reg-up-button"  onclick="sendUpRegistration()" aria-label="Login status" ></button>

    <div id="registration-footer">

        <div class="registration-footer-holder">
            <button id="reg-down-button" type="button" onclick="sendDownRegistration()" aria-label="Hide Login" class="x-button"></button>

            <!--<div id="user-session-status" style="color:grey;font-size:small; width:100%; text-align:left; padding:10px;height: 12px;margin-top:-45px;font-family:'Mulish',sans-serif;"></div>-->
            <div class="form-container" id="login-form-section">
                <div style="text-align:center;width:100%;" >
                    <div class="earthcal-app-logo" style="margin-bottom: 20px;"><img src="svgs/earthcal-icon.svg" style="width:125px;height:125px;"></div>
                    <div id="status-message">Login to EarthCal</div>
                    <div id="sub-status-message">Use a Buwana account to access the full power of Earthcal.</div>
                </div>
                <!-- LOGIN FORM starts here-->
                <div id="login-buttons-container" style="text-align:center;width:100%;margin:auto;margin-top:20px;max-width:500px;display:flex;flex-direction:column;gap:10px;">
                    <button id="auth-login-button" class="login-button">Login with Buwana</button>
                    <button id="auth-signup-button" class="signup-button" onclick="window.location.href='https://buwana.ecobricks.org/en/signup-1.php?app=ecal_7f3da821d0a54f8a9b58'">Sign Up to Earthcal</button>
                    <p style="margin:auto;margin-bottom: -15px;font-size: 0.8em; text-align: center;" data-lang-id="1000-authentication-by" >Authentication by</p>
                    <div class="buwana-word-mark" alt="Buwana Logo" title="Authentication by Buwana" onclick="navigateTo('index.php')" style="cursor:pointer;"></div>
                </div>

            </div>

            <!--To be shown upon login-->
            <div id="logged-in-view" class="modal-message" style="display:none; text-align:center;">
            </div>
        </div>
    </div>
</div>

<!-- GUIDED TOUR-->

<div id="guided-tour" class="modal">
    <div class="tour-content">
        <span id="close-tour-button" class="close-tour" style="padding:10px" onclick="closeTour();">&times;</span>

        <div id="information-one" class="information">
            <div class="tour-image"><img src="cycles/cariboo-cycle-map.svg" style="margin:auto" title="A Quick Tour of the Calendar" alt="A Quick Tour of the Calendar"></div>
            <div class="modal-header" id="tour-header-1"></div>
            <div class="modal-description" id="tour-desc-1"></div>
            <button class="next" id="next-1"></button>
        </div>

        <div id="information-two" style="display:none;" class="information">
            <div class="tour-image"><img src="svgs/cycles-night-over.svg" style="margin:auto" title="One Year. One Orbit." alt="One Year. One Orbit."></div>
            <div class="modal-header" id="tour-header-2"></div>
            <div class="modal-description" id="tour-desc-2"></div>
            <button class="back" id="back-2"></button>
            <button class="next" id="next-2"></button>
        </div>

        <div id="information-three" style="display:none;" class="information">
            <div class="tour-image"><img src="assets/icons/saturn-cycle.svg" title="Our Neighbourhood" alt="Our Neighbourhood"></div>
            <div class="modal-header" id="tour-header-3"></div>
            <div class="modal-description" id="tour-desc-3"></div>
            <button class="back" id="back-3"></button>
            <button class="next" id="next-3"></button>
        </div>

        <div id="information-four" style="display:none;" class="information">
            <div class="tour-image"><img src="svgs/just-moon.svg" title="Sync with the lunar cycles" alt="Sync with the lunar cycles"></div>
            <div class="modal-header" id="tour-header-4"></div>
            <div class="modal-description" id="tour-desc-4"></div>
            <button class="back" id="back-4"></button>
            <button class="next" id="next-4"></button>
        </div>

        <div id="information-five" style="display:none;" class="information">
            <div class="tour-image"><img src="assets/icons/whale.svg" title="Earth and animal cycles" alt="animal cycles"></div>
            <div class="modal-description" id="tour-desc-5"></div>
            <button class="back" id="back-5"></button>
            <button class="next" id="next-5"></button>
        </div>

        <div id="information-six" style="display:none;" class="information">
            <div class="tour-image"><img src="svgs/add-night-over.svg" title="add events" alt="Add events"></div>
            <div class="modal-header" id="tour-header-6"></div>
            <div class="modal-description" id="tour-desc-6"></div>
            <button class="back" id="back-6"></button>
            <button class="next" onclick="closeTour()" id="done"></button>
        </div>
    </div>
</div>



<!--ADD DATECYCLE FORM, hidden-->


<!--MAIN PAGE-->
<div id="page-content">

    <div id="date-cycle-count-box">
        <button
            type="button"
            id="close-datecycle-notice"
            aria-label="Dismiss date cycle count notice"
        ></button>
        <div
            id="current-datecycle-count"
            role="status"
            aria-live="polite"
            aria-atomic="true"
        ></div>
        <div id="eye-icon"></div>
    </div>

    <div id="header" class="top-menu" title="Earthcal v1.0.0">  <!-- Why 140px?-->
        <div class="target-date-info" style="display: flex; flex-flow: column;max-width:95%;position:absolute;right:0;margin-top:10px;z-index:10;min-width:550px;">
            <div class="date-time-add-box" style="display:flex;flex-flow:row;margin-right:10px;height:77px;">
                <div class="date-time-box" style="display:flex;flex-flow:column;text-align:right;margin:auto;margin-right: 5px; /*margin-top: 16px;">
                    <div id="current-date-info"></div>
                    <div id="user-timezone-lang"></div>
                </div>
                <div class="add-event-button" style="justify-content:center;margin-top:auto;margin-bottom: auto;display:flex;z-index:20;padding-top:8px;">
                    <button type="button" class="top-add-button" onclick="openAddItem()" aria-label="Add a Cycle" id="add-datecycle-button"></button>
                </div>
            </div>
            <div id="time-controller">
                <div
                    id="prev-year"
                    class="previous-button"
                    onclick="prevYear()"
                    aria-label="Previous Year"
                    title="Go to previous year"
                ></div>
                <div
                    id="prev-day"
                    class="previous-button"
                    onclick="set2Yesterday()"
                    aria-label="Yesterday"
                    title="Go back one day"
                ></div>
                <div
                    id="reset-to-today"
                    class="today-button"
                    onclick="set2Today()"
                    aria-label="Today"
                    title="Today"
                ></div>
                <div
                    id="next-day"
                    class="next-button"
                    onclick="set2Tomorrow()"
                    aria-label="Next Day"
                    title="Go to next day"
                ></div>
                <div
                    id="next-year"
                    class="next-button"
                    onclick="nextYear()"
                    aria-label="Next Year"
                    title="Go to next year"
                ></div>
                <div>
                    <button type="button" id="event-show-hide" class="eye-open" onclick="toggleDateCycleView()" aria-label="Show/Hide events" style="width: 45px;
  margin: 6px 5px 0px 0px;">
                    </button>
                </div>
            </div>

        </div>



        <!--PINNED-->
        <div id="all-pinned-datecycles" style="height:calc(100vh - 265px); margin-top: 140px; position: relative; overflow: hidden;pointer-events: none;">
            <!-- Top gradient overlay -->
            <div id="top-gradient-pinned" class="top-gradient-overlay"></div>
            <div id="pinned-datecycles" class="date-info" style="
                        height: 100%;
                        overflow-y: auto;
                        direction: rtl; /* Force scrollbar to the left */
                        text-align: left; /* Ensure content alignment remains left-to-right */

                        padding: 0 12px;
                        position: relative;
                        z-index: 21;
                        background:var(--transparent);
                        ">
            </div>
            <!--<div id="bottom-gradient-pinned" class="bottom-gradient-overlay"></div>-->
        </div>
        <!--CURRENT-->
        <div id="all-current-datecycles" style="overflow-y: auto;height:calc(100vh - 150px);width:fit-content;margin-left:auto;margin-right:12px;padding-top:117px;  position: relative;background:none;"><div id="top-gradient-current" class="top-gradient-overlay"></div>
            <div id="current-datecycles" class="date-info" style="overflow-y: auto;position: relative;height:auto;
                        z-index: 21;
                        ">
            </div>
            <!--<div id="bottom-gradient-current" class="bottom-gradient-overlay"></div>-->
        </div>
    </div>

    <div id="top-left-buttons" class="button-list" style="display:flex;position:absolute;left:0;width:fit-content;margin-left:10px;flex-flow:column;margin-top:15px;z-index:20;top:0;background: var(--general-background);
      border-radius: 15px;">
        <div><button type="button" id="top-menu" class="top-menu-button" onclick="openMainMenu()" aria-label="Open site settings"></button></div>
        <div><button type="button" id="top-search" class="top-search-button" onclick="openDateSearch()" aria-label="Date Search"></button></div>
        <div><button type="button" id="top-settings" class="top-settings-button" onclick="showUserCalSettings()" aria-label="Calendar Settings"></button></div>

    </div>

    <div class="planet-info-container" style="width:100%;height:100vh;display:flex;justify-content: center;text-align: center;">
        <div id="neptune-cycle" class="planet-info-box">
            <div id="neptune-phase" style="font-size:1.9em;padding:5px;filter:hue-rotate(200.6deg) saturate(140%) brightness(80%);">🌕</div>
            <div id="neptune-phase-info" style="text-align: center;" class="planet-info"><span style="font-size:1.5em;"> Neptune ♆</span><br>Orbit: 164.81 years<br>
                Max Dist.: 30.1 AU<br>
                Min Dist: 29.8 AU</div>
            <button type="button" style="cursor:pointer; margin-top:15px;" onclick="closePlanetInfoBoxes()" aria-label="Click to close settings page" class="x-button close-planet-info-button"></button>
        </div>
        <div id="uranus-cycle" class="planet-info-box">
            <div id="uranus-phase" style="font-size:1.9em;padding:5px;filter:hue-rotate(145deg) saturate(140%);">🌕</div>
            <div id="uranus-phase-info" style="text-align:center;" class="planet-info"><span style="font-size:1.5em;">Uranus ♅ </span><br>Orbit: 84.07 years<br>
                Max Dist.: 20.1 AU<br>
                Min Dist.: 29.8 AU</div>
            <button type="button" style="cursor:pointer; margin-top:15px;" onclick="closePlanetInfoBoxes()" aria-label="Click to close settings page" class="x-button close-planet-info-button"></button>
        </div>
        <div id="saturn-cycle" class="planet-info-box">
            <div id="saturn-phase" title="Saturn" style="filter:saturate(50%)"></div>
            <div id="saturn-phase-info" class="planet-info"></div>
            <button type="button" style="cursor:pointer; margin-top:15px;" onclick="closePlanetInfoBoxes()" aria-label="Click to close settings page" class="x-button close-planet-info-button"></button>
        </div>
        <div id="jupiter-cycle" class="planet-info-box">
            <div id="jupiter-phase" title="Jupiter"  style="padding:0px;filter:hue-rotate(330deg) saturate(360%);"></div>
            <div id="jupiter-phase-info" class="planet-info"></div>
            <button type="button" style="cursor:pointer; margin-top:15px;" onclick="closePlanetInfoBoxes()" aria-label="Click to close settings page" class="x-button close-planet-info-button"></button>
        </div>
        <div id="mars-cycle" class="planet-info-box">
            <div id="mars-phase" title="Mars Phase" style="padding:10px; filter:hue-rotate(310deg) saturate(900%) brightness(70%);"></div>
            <div id="mars-phase-info" class="planet-info"></div>
            <button type="button" style="cursor:pointer; margin-top:15px;" onclick="closePlanetInfoBoxes()" aria-label="Click to close settings page" class="x-button close-planet-info-button"></button>
        </div>
        <div id="earth-cycle" class="planet-info-box">
            <div id="earth-phase"><img src="cycles/cariboo-cycle-map.svg" width="40" heigh="40"></div>
            <div id="earth-phase-info" style="text-align: right;display: contents;" class="planet-info"><span style="font-size:1.5em;">Earth ♁</span><br>
                The third planet from the sun.<br>
                Orbit: 1 year<br>
                Distance from sun: 1 AU<br>
            </div>
            <button type="button" style="cursor:pointer; margin-top:15px;" onclick="closePlanetInfoBoxes()" aria-label="Click to close settings page" class="x-button close-planet-info-button"></button>
        </div>
        <div id="venus-cycle" class="planet-info-box">
            <div id="venus-phase" style="padding:10px;filter:hue-rotate(45deg) saturate(300%);"></div>
            <div id="venus-phase-info" style="text-align: right;display: contents;" class="planet-info"></div><br>
            <button type="button" style="cursor:pointer; margin-top:15px;" onclick="closePlanetInfoBoxes()" aria-label="Click to close settings page" class="x-button close-planet-info-button"></button>
        </div>
        <div id="mercury-cycle" class="planet-info-box">
            <div id="mercury-phase" style="padding:10px;filter:hue-rotate(295deg) saturate(70%) brightness(70%);">🌕</div>
            <div id="mercury-phase-info" style="text-align: right;display: contents;" class="planet-info"><span style="font-size:1.5em;">Mercury ☿</span><br>
                Orbit: 0.24 years<br>
                max Dist.': 1.4 AU<br>
                min Dist.': 0.61 AU</div><br>
            <button type="button" style="cursor:pointer; margin-top:15px;" onclick="closePlanetInfoBoxes()" aria-label="Click to close settings page" class="x-button close-planet-info-button"></button>
        </div>
        <div id="moon-cycle" class="planet-info-box">
            <div id="moon-phase" style="font-size:x-small;height:75px" class="phase-image" ></div>
            <div id="moon-info" class="planet-info" style="text-align: right;display: contents;"></div><br>
            <button type="button" style="cursor:pointer; margin-top:15px;" onclick="closePlanetInfoBoxes()" aria-label="Click to close settings page" class="x-button close-planet-info-button"></button>
        </div>
    </div>

    <!--ANIMALS-->
    <div id="whale-cycle" class="animal-info-box">
        <div id="whale-phase" class="phase-image">
            <img src="assets/icons/whale.svg" width="60" height="40"></div>
        <div id="whale-info" class="planet-info" style="text-align: left;">
        </div>
    </div>

    <div id="stork-cycle" class="animal-info-box">
        <div id="stork-phase" class="phase-image">
            <img src="assets/icons/stork.svg" width="60" height="40">
        </div>
        <div id="stork-info" class="planet-info" style="text-align: left;">

        </div>
    </div>

    <div id="loading-spinner" style="display:none !important;"></div>

    <div id="the-cal">
        <!--Init will Insert the The raw file here-->
    </div>

    <!-- MAIN PAGE MENU -->
    <div id="main-menu-overlay" class="overlay-settings">
        <button type="button" style="cursor:pointer" onclick="closeMainMenu(), updateBackgroundColor(),
          updateHighlightColor()" aria-label="Close" class="x-button">
        </button>
        <div id="main-menu-content" class="overlay-content-settings"></div>
    </div>

    <!-- PALETTE MAIN BUTTONS -->
    <div id="bottom-left-buttons" class="icon-button-columns">
        <button id="solarsystem-button" class="cycle-toggle" data-show="planet-buttons" data-hide="kin-buttons themoonphases americas-map euro-map moon-cycle moon-phase" title="Activate Planet Cycles" data-role="palette-root"></button>
        <button id="whale-earthbutton" class="cycle-toggle" data-show="kin-buttons" data-hide="planet-buttons themoonphases americas-map euro-map moon-cycle moon-phase" title="Activate ecological cycles" data-role="palette-root"></button>
        <button id="moon-button" class="cycle-toggle" data-show="moon-cycle moon-phase themoonphases" data-hide="planet-buttons kin-buttons americas-map euro-map" data-function="calculateHijriMonthNames" title="Activate lunar tracking" data-role="palette-root"></button>
    </div>

    <!-- PALETTE KIN BUTTONS -->
    <div id="kin-buttons" class="icon-button-row">
        <button type="button" id="whale-button" class="totems-icon active cycle-toggle" data-show="americas-map whale-cycle whale-info whale-cycler" data-hide="stork-cycle stork-info storkCycler" data-function="UpdateWhaleCycle animateWhaleCycle" style="border-color:blue;" aria-label="Access whale cycle"><img src="assets/icons/whale.svg" title="grey whale migration"></button>
        <button type="button" id="stork-button" class="totems-icon cycle-toggle" data-show="euro-map stork-cycle stork-info storkCycler" data-hide="whale-cycle whale-info whaleCycler" data-function="updateStorkCycle"  aria-label="Access stork cycle" style="border-color:red;"><img src="assets/icons/stork.svg" title="black stork migration"></button>
        <button type="button" id="cariboo-button" class="totems-icon"  aria-label="Access cariboo cycle" style="border-color:teal;"><img src="assets/icons/cariboo.svg" title="Cariboo migration"></button>
        <button type="button" id="monarch-button" class="totems-icon"  aria-label="Access monarch cycle" style="border-color:orange;"><img src="assets/icons/monarch.svg"></button>
    </div>

    <!-- PLANET BUTTONS -->
    <div id="planet-buttons" class="icon-button-column">
        <button type="button" id="saturn-button" class="planet-icon cycle-toggle" data-show="saturn-cycle" data-function="UpdateSaturnData" title="Saturn" style="border-color:grey"><img src="assets/icons/saturn-cycle.svg" aria-label="Access Saturn's cycle"></button>
        <button type="button" id="jupiter-button" class="planet-icon cycle-toggle" data-show="jupiter-cycle" data-function="UpdateJupiterData"   style="border-color:#f59d04;" aria-label="Access Jupiter's cycle" title="Jupiter"><img src="assets/icons/jupiter-cycle.svg" ></button>
        <button type="button" id="mars-button" class="planet-icon cycle-toggle" data-show="mars-cycle" data-function="UpdateMarsData"   aria-label="Access Mars's cycle" title="Mars" style="border-color:red;"><img src="assets/icons/mars-cycle.svg"></button>
        <button type="button" id="venus-button" class="planet-icon cycle-toggle" data-show="venus-cycle" data-function="UpdateVenusData"  aria-label="Access Venus's cycle" title="Venus" style="border-color:green;"><img src="assets/icons/venus-cycle.svg"></button>
        <button type="button" id="mercury-button" class="planet-icon cycle-toggle" data-show="mercury-cycle" data-function="UpdateMercuryData"  aria-label="Access Mercury cycle" title="☿ Mercury" style="border-color:rgb(144, 106, 4);"><img src="assets/icons/mercury-cycle.svg"></button>
    </div>
</div>  <!--close page content-->

</BODY>

<script>
    async function showIntroModal() {
        const tokenKey = 'newVersionInfoSeen';
        const lang = (userLanguage || 'en').toLowerCase();

        const translations = await loadTranslations(lang);
        const content = translations.versioning;

        const featureList = content.features.map(feature => `<li>${feature}</li>`).join('');
        const modalContent = `
        <div style="text-align:center;">
            <h1>${content.title}</h1>
            <h4>${content.subtitle}</h4>
        </div>
        <div style="width:80%; margin: 10px auto 10px auto;" class="feature-list">
            <ul style="font-size:1em;">${featureList}</ul>
        </div>
        <div style="display:flex;flex-flow:column;justify-content:center;">
            <button id="got-it-button" class="confirmation-blur-button enabled" style="margin-bottom:0px;">${content.gotIt}</button>
            <button id="take-tour" class="confirmation-blur-button" style="margin-top:10px; background:var(--general-background-highlight);">${content.tour}</button>
        </div>
    `;

        const modalBox = document.getElementById('modal-content');
        modalBox.innerHTML = modalContent;

        const modal = document.getElementById('form-modal-message');
        modal.classList.remove('modal-hidden');
        modal.classList.add('modal-visible');
        modal.classList.add('dim-blur');

        document.getElementById('got-it-button').addEventListener('click', function () {
            closeTheModal();
            localStorage.setItem(tokenKey, 'true');
        });

        document.getElementById('take-tour').addEventListener('click', function () {
            closeTheModal();
            localStorage.setItem(tokenKey, 'true');
            guidedTour();
            sendDownRegistration();
        });
    }



    function checkTourToken() {
        // Check if the token exists in localStorage
        const tourToken = localStorage.getItem('tourToken');

        if (!tourToken) {
            // Token doesn't exist, trigger the guided tour
            guidedTour(); sendDownRegistration();
        }
    }

    function tourTaken() {
        // Save the token in localStorage to indicate that the tour has been seen
        localStorage.setItem('tourToken', 'seen');

    }

</script>


<script>
    // JavaScript to handle touch events
    // Get all SVG elements containing paths with id*="-day"
    //const currentElements = svg.querySelectorAll("path[id*='-day'], g[id*='-day']");

    const svgElements = document.querySelectorAll("svg");
    const paths = [];

    let selectedPath = null; // Track the currently selected path

    svgElements.forEach((svg) => {
        // Get the paths in the current SVG that have '-day' in their ID
        const currentPaths = svg.querySelectorAll("path[id*='-day']");
        paths.push(...currentPaths);

        currentPaths.forEach((path) => {
            // Add click and touch event listeners to each path
            path.addEventListener("click", function () {
                resetPaths(); // Reset all paths to their default state
                this.classList.add("active", "final");
                selectedPath = this; // Set this path as the selected path
            });
            path.addEventListener("touchstart", onTouch, false);
            path.addEventListener("touchmove", onTouch, false);
            path.addEventListener("touchend", onTouchEnd, false);
        });
    });


    function onTouch(event) {
        // Prevent default touch behavior
        event.preventDefault();

        // Get the touch object
        const touch = event.changedTouches[0];

        // Get the element at the touch position
        const targetElement = document.elementFromPoint(touch.clientX, touch.clientY);

        // Check if the touched element is a path with '-day' in its ID
        if (targetElement.tagName === "path" && targetElement.matches("path[id*='-day']")) {
            // Remove the 'active' class from all '-day' paths and set fill-opacity to 0.3
            paths.forEach((path) => {
                if (path.id.includes('-day')) {
                    path.classList.remove("active");
                    // path.style.fillOpacity = "0.3"; // Set fill-opacity to 0.3
                }
            });

            // Add the 'active' class to the touched element
            targetElement.style.transition = 'none'; // Disable transitions temporarily
            targetElement.classList.remove("final");
            targetElement.classList.add("active");

            setTimeout(() => {
                targetElement.style.transition = ''; // Enable transitions again
            }, 0);

            selectedPath = targetElement; // Update the selected path

            // Call the handleDayPathTouchStart function with the ID of the selected path
            handleDayPathTouchStart(selectedPath.id);
            displayMoonPhaseOnTouch(selectedPath.id);
        }
    }



    function onTouchEnd(event) {
        // Prevent default touch behavior
        event.preventDefault();

        // Remove the 'active' class from all paths
        // paths.forEach((path) => path.classList.remove("final"));
        // resetPaths();

        // Check if the selected path contains '-day' in its ID
        if (selectedPath.id.includes("-day")) {


            let pathIdArr = selectedPath.id.split('-'); // Corrected variable name from pathId to selectedPath.id
            let month = pathIdArr[2] - 1;
            let day = pathIdArr[1];
            let year = pathIdArr[3];
            targetDate = new Date(year, month, day);

            calendarRefresh();


            startDate = targetDate;
            // document.getElementById("reset").style.display = "block";
            /* document.getElementById("tomorrow").style.display = "none";
             document.getElementById("yesterday").style.display = "none";*/
            // document.getElementById("current-time").style.display = "none";

            // displayMoonPhaseOnTouch(selectedPath.id);

        }

        // Add the 'final' class to the selected path (if it exists)
        if (selectedPath && selectedPath.classList.contains("active")) {
            selectedPath.classList.add("final");
        }
    }

    // Helper function to reset all paths to their default state
    function resetPaths() {
        paths.forEach((path) => {
            path.classList.remove("active");
            path.classList.remove("final");
        });
    }
</script>


<script>
    const container = document.getElementById('registration-container');
    const children  = [
        document.getElementById('reg-up-button'),
        document.getElementById('registration-footer')
    ];

    children.forEach(el => {
        el.addEventListener('mouseenter', () => container.classList.add('hover'));
        el.addEventListener('mouseleave', () => container.classList.remove('hover'));
    });
</script>


<!-- FINAL LOADED SCRIPTS -->

<script src="js/1-event-management.js?v=3.1"></script>
<script src="js/kin-cycles.js"></script>



</html>


